<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Document</title>
</head>
<body>
	<script>
		// SOURCE INSTRUCTION POINTER, i.e. which line are we on rn?
		let SIP = 0;



		// yessss
		let l = (x) => {
			console.log(x);
		}

		// Guess what fools, all caps right now are used for certain big ass global
		// variables as I feel like it, some are constant, some are not!

		// valid binary op to bools
		let VALID_BOBS = ["!=", "=="];

		// oyy veyy, and now it begins
		let LD = -1; // LOOP-DEPTH. in first loop becomes 0 to point to *first* entry
		let loop_idxes = [];
		let loop_rlens = []; // run lengths

		// whether or not the if check is on, i.e. are we applying it?
		let ICON = true;


		// lets KISS that right now we only have ints legal in teh lang-lang.
		let getIntMeaning = (blah) => {

			// if it is in int format, job is easy
			let n = parseInt(blah);
			if (!isNaN(n)) {
				return n;
			}

			// hardwiring some magic next
			if (blah == "*idx*") {
				return loop_idxes[LD];
			}
			if (blah == "**idx**") {
				return loop_idxes[LD-1];
			}

		}



		// indexed from 0
		let getNthWord = (line, n) => {
			line = line.trimLeft();
			let words = line.split(' ');
			return words[n];
		}

		let getFirstWord = (line) => {
			return getNthWord(line, 0);
		}

		let performDataFunction = (line) => {

			// handle whitespace flab && comment lines
			if (line.length == 0) {
				l('Harmless lengthless line');
				SIP++;
				return;
	
			}
			if (line[0] == '/' && line[1] == '/') {
				l('Twas a comment!');
				SIP++;
				return;
			}



			let OP = getFirstWord(line)


			// with no icon, we skip over code, unless we find a FI which
			// tells us to switch back
			if (!ICON) {
				console.log('In the darkness, no icon!!!');
				if (OP == "fi") {
					ICON = true;
					l('Icon now set back to true, yayy!');
				}
				SIP++;
				return;
			}



			switch(OP) {

				case "fi":
					ICON = true;
					console.log("FI", line);
					break;

				case "lp":
					console.log("LP", line);

					let start = getNthWord(line, 1);
					let nruns = getNthWord(line, 2);

					LD++;
					loop_idxes[LD] = start;
					loop_rlens[LD] = nruns;

					l(loop_idxes);
					l(loop_rlens);
					break;

				case "pl":
					console.log("PL", line);
					break;

				case "if":
					console.log("IF", line);

					// simple assumptions now for the win
					let arg1 = getNthWord(line, 1);
					let bob = getNthWord(line, 2); // bin op bool
					let arg2 = getNthWord(line, 3);


					if (!VALID_BOBS.includes(bob)) {
						console.log('FAIL, unsupported bob:', bob);
					}

					let arg1int = getIntMeaning(arg1);
					let arg2int = getIntMeaning(arg2);

					if (bob == "==") {
						IC = (arg1int == arg2int);
						break;
					}
					if (bob == "!=") {
						IC = (arg1int != arg2int);
						break;
					}

					break;


				default:
					console.log("YA", line);


			}			

			SIP++;

		}
			


		let sauce = `
// Screen S starts out all 0, all black

lp 1 10
	lp 5 20
		if *idx* != **idx**
			#42 -> S[**idx**][*idx*]
		fi
	pl
pl`

		l(`up and running`);
		l(sauce);




		sauceLines = sauce.split('\n');

		while (true) {
			if (SIP >= sauceLines.length || SIP < 0) {
				l("SIP has fallen off the map, maybs cuz program finished");
				break;

			}
			performDataFunction(sauceLines[SIP]);
		}




	</script>
</body>
</html>