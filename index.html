<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Document</title>
</head>
<body>
	<script>
		// yessss
		let l = (x) => {
			console.log(x);
		}

		// Guess what fools, all caps right now are used for certain big ass global
		// variables as I feel like it, some are constant, some are not!

		// valid binary op to bools
		let VALID_BOBS = ["!=", "=="];

		// oyy veyy, and now it begins
		let LD = -1; // LOOP-DEPTH. in first loop becomes 0 to point to *first* entry
		let loop_idxes = [];
		let loop_rlens = []; // run lengths

		// whether or not the if check is on, i.e. are we applying it?
		let ICON = true;


		// lets KISS that right now we only have ints legal in teh lang-lang.
		let getIntMeaning = (blah) => {

			// if it is in int format, job is easy
			let n = parseInt(blah);
			if (!isNaN(n)) {
				return n;
			}

			// hardwiring some magic next
			if (blah == "*idx*") {
				return loop_idxes[LD];
			}
			if (blah == "**idx**") {
				return loop_idxes[LD-1];
			}

		}



		// indexed from 0
		let getNthWord = (line, n) => {
			line = line.trimLeft();
			let words = line.split(' ');
			return words[n];
		}

		let getFirstWord = (line) => {
			return getNthWord(line, 0);
		}

		let performDataFunction = (line) => {

			// not handling nested case yet
			if (getFirstWord(line) == "fi") {
				ICON = true;
				console.log("FI", line);
				return;
			}



			// first let's check if we're inside of code that we are ignoring
			// because the if-check failed.
			if (!ICON) { // we shall not pass...
				console.log('In the darkness, no icon!!!');
				if ("fi" == getFirstWord(line)) {
					ICON = true;
					l('Icon now set back to true, yayy!');
				}
				return;
			}




			if (line.length == 0) {
				// let's just do nothing for these nothing lines
				return;
			}
			if (line[0] == '/' && line[1] == '/') {
				l('Twas a comment!');
				return;
			}

			if (getFirstWord(line) == "lp") {
				console.log("LP", line);

				let start = getNthWord(line, 1);
				let nruns = getNthWord(line, 2);

				LD++;
				loop_idxes[LD] = start;
				loop_rlens[LD] = nruns;

				l(loop_idxes);
				l(loop_rlens);
				return;
			}

			if (getFirstWord(line) == "pl") {
				console.log("PL", line);

				// we need to do the loop actions, like:
				// inc'ing idx and setting the instruction back
				// continuing and popping off loop state

				// Ohh yeah, so far I've been performDataFunction
				// on the sauce lines just in a row, start to finish

				// Once I generalize here, it might be more elegant (not
				// fussing about cpu bound perf here) to have IF's 
				// jump to the right spot, instead of "see non evil" 
				// ignoring the code as they pass over it line by line.

				// Let's not bite off more than you can chew now though.






				return;


			}



			if (getFirstWord(line) == "if") {
				console.log("IF", line);

				// simple assumptions now for the win
				let arg1 = getNthWord(line, 1);
				let bob = getNthWord(line, 2); // bin op bool
				let arg2 = getNthWord(line, 3);


				if (!VALID_BOBS.includes(bob)) {
					console.log('FAIL, unsupported bob:', bob);
				}

				let arg1int = getIntMeaning(arg1);
				let arg2int = getIntMeaning(arg2);
				/*l('youuuuuu');
				l(arg1int);
				l(arg2int);*/

				if (bob == "==") {
					IC = (arg1int == arg2int);
					return;
				}
				if (bob == "!=") {
					IC = (arg1int != arg2int);
					return;
				}


				return;
			}




			
			console.log("YA", line);
		}
			


		let sauce = `
// Screen S starts out all 0, all black

lp 1 10
	lp 5 20
		if *idx* != **idx**
			#42 -> S[**idx**][*idx*]
		fi
	pl
pl`

		l(`up and running`);
		l(sauce);




		sauceLines = sauce.split('\n');

		for (let i = 0; i < sauceLines.length; i++) {
			performDataFunction(sauceLines[i]);
		}




	</script>
</body>
</html>